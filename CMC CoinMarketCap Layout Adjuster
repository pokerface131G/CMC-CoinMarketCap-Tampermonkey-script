// ==UserScript==
// @name         CMC CoinMarketCap Advanced Layout Adjuster -removeRightTable
// @namespace    http://tampermonkey.net/
// @version      4.0
// @description  Adjusts CoinMarketCap layout by removing RIGHT table and Community section, expanding overview
// @author       Combined by Claude
// @match        https://coinmarketcap.com/view/*
// @match        https://coinmarketcap.com/currencies/*
// @grant        none
// @run-at       document-start
// ==/UserScript==

// https://coinmarketcap.com/view/solana-ecosystem/ ， https://coinmarketcap.com/currencies/degen-base/   隐藏右边表格，并扩展页面。不用 better coinmarketcap 插件了。嘿嘿。
// 1， 页面代码如下。<div class="grid full-width-layout">  …  隐藏 div id = overview 表格后的下一个表格，并释放它占用的显示空间。将 div id = overview 表格 扩展到所释放的空间。 用TAMPERMONKEY .
// 2， 页面代码见附件。 你写个 TAMPERMONKEY 脚本，将 页面里 Coin-Community 部分隐藏。 参考 better CMC 这个代码写，它可以实现隐藏。
// 这次行了。但是 页面首先会出来空格，然后是页面扩展，消除了空格。可以再优化一下吗。  => done . NB.
// 将 2个代码合并。

(function() {
    'use strict';

    // 添加初始样式到页面头部
    const styleSheet = document.createElement('style');
    styleSheet.textContent = `
        /* 隐藏社区部分 */
        .Coin-Community {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            min-height: 0 !important;
            max-height: 0 !important;
            overflow: hidden !important;
        }

        /* 调整大屏幕布局 */
        @media screen and (min-width: 1280px) {
            .cmc-body-wrapper .full-width-layout > div:first-child {
                grid-template-columns: 25% 75% !important;
            }
        }

        /* Overview 部分样式 */
        #overview {
            height: auto !important;
            min-height: 800px !important;
            flex-grow: 1 !important;
            transition: all 0.3s ease-in-out !important;
        }

        #overview > div {
            height: auto !important;
            min-height: 100% !important;
            max-height: none !important;
            transition: all 0.3s ease-in-out !important;
        }

        .sc-9c4d5e5b-2,
        div[data-module-name="Coin-Community"].sc-65e7f566-0 {
            height: auto !important;
            min-height: 100% !important;
            max-height: none !important;
            transition: all 0.3s ease-in-out !important;
        }
    `;
    document.head.appendChild(styleSheet);

    function adjustLayout() {
        const overview = document.getElementById('overview');
        if (!overview) return;

        const tableToRemove = overview.nextElementSibling;
        if (!tableToRemove) return;

        // 立即隐藏要删除的表格，防止闪烁
        tableToRemove.style.display = 'none';
        tableToRemove.style.height = '0';
        tableToRemove.style.opacity = '0';

        // 立即调整父容器
        const parentContainer = overview.parentElement;
        if (parentContainer) {
            parentContainer.style.cssText = `
                display: flex !important;
                flex-direction: column !important;
                height: auto !important;
                min-height: 800px !important;
                transition: all 0.3s ease-in-out !important;
            `;
        }

        // 延迟极短时间后删除表格
        requestAnimationFrame(() => {
            tableToRemove.remove();
        });
    }

    // 使用 MutationObserver 在DOM变化时立即处理
    const observer = new MutationObserver((mutations) => {
        for (const mutation of mutations) {
            if (mutation.addedNodes.length) {
                const overview = document.getElementById('overview');
                if (overview) {
                    adjustLayout();
                    break;
                }
            }
        }
    });

    // 在页面开始加载时就启动观察
    observer.observe(document.documentElement, {
        childList: true,
        subtree: true
    });

    // 多重检查以确保执行
    ['DOMContentLoaded', 'load', 'readystatechange'].forEach(event => {
        window.addEventListener(event, () => {
            requestAnimationFrame(adjustLayout);
        }, { once: true });
    });

    // 初始执行
    if (document.readyState !== 'loading') {
        requestAnimationFrame(adjustLayout);
    }
})();
